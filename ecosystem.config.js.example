const path = require('path');

module.exports = {
    apps: [
        {
            // --- 基本信息 ---
            name: 'prompt-house', // 你的应用名称

            // --- 路径和脚本 ---
            // 使用 path.resolve(__dirname) 来确保 cwd 是一个绝对路径
            // __dirname 指的是 ecosystem.config.js 文件所在的目录
            cwd: path.resolve(__dirname), 
            script: 'npm', // 要执行的命令
            args: 'start', // 传递给命令的参数

            // --- 模式和实例 ---
            exec_mode: 'fork', // 指定为 fork 模式
            // 在 fork 模式下，instances 会被忽略，但明确写出可以避免误解
            // instances: 1, 

            // --- 高级配置 ---
            watch: false, // 生产环境绝对不要开启 watch
            autorestart: true, // 开启自动重启
            max_memory_restart: '2G', // 当内存超过 2G 时自动重启

            // --- 环境变量 ---
            env: {
                NODE_ENV: 'production', // 必须设置为 'production'
                PORT: 3001, // 指定应用监听的端口
                // --- 在这里添加你所有的生产环境变量 ---
                NODE_ENV: 'production',
                DATABASE_URL: 'postgresql://prompthouse:prompthouse_admin_123456@localhost:5432/prompthouse?schema=public',
                AUTH_SECRET: 'XXX',
                NEXTAUTH_URL: 'https://prompthouse.gocoding.cloud',
            },
        },
    ],
};